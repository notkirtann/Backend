# Express App Integration & Professional Backend Utilities – Notes

---

## 1. Express Setup (app.js)

### Create Express App

**app.js**

```js
import express from "express";

const app = express();

export default app;
```

Purpose:

* Keep Express configuration separate
* Cleaner architecture
* Used later in `index.js`

---

## 2. Database Connection & Server Start

**index.js**

```js
import dotenv from "dotenv";
import app from "./app.js";
import connectDB from "./db/connectDB.js";

dotenv.config();

connectDB()
  .then(() => {
    app.listen(process.env.PORT || 8000, () => {
      console.log(`Server running on port ${process.env.PORT || 8000}`);
    });
  })
  .catch((err) => {
    console.error("Database connection failed:", err);
  });
```

### Key Idea

Start server **only after DB connection succeeds**.

---

## 3. Middleware Setup

Middleware processes incoming requests.

### Install Required Packages

```bash
npm install cors cookie-parser
```

---

### JSON & Body Parsing

```js
app.use(express.json({ limit: "16kb" }));
app.use(express.urlencoded({ extended: true, limit: "16kb" }));
```

Why?

* Accept JSON data
* Handle form submissions
* Prevent large payload attacks

---

## 4. Cookie Parser

```js
import cookieParser from "cookie-parser";

app.use(cookieParser());
```

Purpose:

* Read cookies from request
* Set secure cookies
* Useful for authentication (JWT in cookies)

---

## 5. CORS (Cross-Origin Resource Sharing)

```js
import cors from "cors";

app.use(cors({
  origin: process.env.CORS_ORIGIN,
  credentials: true
}));
```

Why?

* Allow frontend (different domain) to access backend
* Restrict unauthorized origins

Example `.env`

```
CORS_ORIGIN=http://localhost:3000
```

---

## 6. Static File Serving

Serve files from a folder.

```js
app.use(express.static("public"));
```

Example access:

```
public/images/logo.png
→ http://localhost:8000/images/logo.png
```

Used for:

* Images
* PDFs
* Uploaded files

---

## 7. Async Handler Utility

Avoid repeating try–catch in controllers.

### asyncHandler.js

```js
const asyncHandler = (fn) => {
  return (req, res, next) => {
    Promise.resolve(fn(req, res, next)).catch(next);
  };
};

export default asyncHandler;
```

Usage:

```js
router.get("/users", asyncHandler(async (req, res) => {
  const users = await User.find();
  res.json(users);
}));
```

Benefits:

* Cleaner controllers
* Centralized error handling

---

## 8. Custom ApiError Class

Standardize error responses.

### ApiError.js

```js
class ApiError extends Error {
  constructor(statusCode, message = "Something went wrong", errors = [], stack = "") {
    super(message);
    this.statusCode = statusCode;
    this.data = null;
    this.message = message;
    this.success = false;
    this.errors = errors;

    if (stack) {
      this.stack = stack;
    } else {
      Error.captureStackTrace(this, this.constructor);
    }
  }
}

export default ApiError;
```

Usage:

```js
throw new ApiError(404, "User not found");
```

---

## 9. Custom ApiResponse Class

Standard success responses.

### ApiResponse.js

```js
class ApiResponse {
  constructor(statusCode, data, message = "Success") {
    this.statusCode = statusCode;
    this.data = data;
    this.message = message;
    this.success = true;
  }
}

export default ApiResponse;
```

Usage:

```js
return res.status(200).json(
  new ApiResponse(200, user, "User fetched successfully")
);
```

---

## 10. Standard Response Format

### Success

```json
{
  "statusCode": 200,
  "data": {},
  "message": "Success",
  "success": true
}
```

### Error

```json
{
  "statusCode": 404,
  "message": "User not found",
  "success": false
}
```

---

## 11. Professional app.js Example

```js
import express from "express";
import cors from "cors";
import cookieParser from "cookie-parser";

const app = express();

app.use(cors({
  origin: process.env.CORS_ORIGIN,
  credentials: true
}));

app.use(express.json({ limit: "16kb" }));
app.use(express.urlencoded({ extended: true, limit: "16kb" }));
app.use(cookieParser());

app.use(express.static("public"));

export default app;
```

---

## 12. Architecture Flow

```
Request
→ Middleware (CORS, JSON, Cookies)
→ Route
→ Controller (asyncHandler)
→ Database
→ ApiResponse / ApiError
→ Response
```

---

## 13. Why This Matters (Industry)

| Feature            | Benefit                   |
| ------------------ | ------------------------- |
| asyncHandler       | Cleaner code              |
| ApiError           | Consistent errors         |
| ApiResponse        | Standard responses        |
| Separate app/index | Scalable structure        |
| CORS & Cookies     | Production-ready security |

---

## Goal

Build a:

* Clean Express architecture
* Reusable error handling
* Standardized API responses
* Production-ready backend foundation

# MongoDB Atlas Setup & Connection – Backend Notes

---

## 1. MongoDB Atlas Setup (Free Cluster)

### Steps

1. Go to **MongoDB Atlas**
2. Create a **Project**
3. Click **Build Database**
4. Choose:

   * Shared (Free Tier)
5. Select:

   * Cloud Provider
   * Region
6. Create Cluster

---

## 2. Database User Access

### Create Database User

* Username
* Password
* Role: Read & Write

Example:

```
username: admin
password: StrongPassword123
```

This will be used in your connection string.

---

## 3. Network Access

### Development Setup

Add:

```
0.0.0.0/0
```

Meaning: Allow access from anywhere.

⚠️ **Not recommended for production**

Production:

* Whitelist specific IPs only.

---

## 4. Connection String

From Atlas → **Connect → Drivers**

Example:

```
mongodb+srv://username:password@cluster.mongodb.net/dbname
```

Store this in `.env`.

---

## 5. Environment Variables (.env)

Install dotenv:

```bash
npm install dotenv
```

Create `.env`:

```
PORT=8000
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/taskdb
```

Load early in app:

```js
import dotenv from "dotenv";
dotenv.config();
```

Why?

* Security
* Environment flexibility
* No hardcoding credentials

---

## 6. Database Connection Approaches

### Approach 1: Inline in index.js (Not Recommended)

Example using IIFE:

```js
import mongoose from "mongoose";

(async () => {
  try {
    await mongoose.connect(process.env.MONGODB_URI);
    console.log("DB Connected");
  } catch (error) {
    console.error("DB Connection Error", error);
  }
})();
```

Problem:

* Not scalable
* Poor separation of concerns

---

### Approach 2: Separate Module (Professional)

#### Step 1: Create folder

```
src/
 └── db/
      connectDB.js
```

#### connectDB.js

```js
import mongoose from "mongoose";

const connectDB = async () => {
  try {
    const conn = await mongoose.connect(process.env.MONGODB_URI);
    console.log(`MongoDB Connected: ${conn.connection.host}`);
  } catch (error) {
    console.error("Database connection failed:", error.message);
    process.exit(1);
  }
};

export default connectDB;
```

#### index.js

```js
import dotenv from "dotenv";
import express from "express";
import connectDB from "./db/connectDB.js";

dotenv.config();

const app = express();

connectDB();

app.listen(process.env.PORT, () => {
  console.log(`Server running on port ${process.env.PORT}`);
});
```

---

## 7. Key Database Principles

### Rule 1: Always Use async/await

Database operations are:

* Network-based
* Slow compared to local operations

Example:

```js
await User.find();
```

---

### Rule 2: Always Use try–catch

```js
try {
  const users = await User.find();
} catch (error) {
  console.error(error);
}
```

Prevents app crashes.

---

## 8. Common Issues & Fixes

| Problem              | Solution                                  |
| -------------------- | ----------------------------------------- |
| Connection failed    | Check username/password                   |
| Timeout error        | Check Network Access (IP whitelist)       |
| Undefined URI        | Check `.env` loaded correctly             |
| Module error         | Ensure `"type": "module"` in package.json |
| File extension error | Use `.js` in imports                      |

---

## 9. Debugging Strategy

1. Read error message carefully
2. Verify:

   * `.env` values
   * Connection string
   * IP whitelist
3. Check:

```js
console.log(process.env.MONGODB_URI);
```

4. Ensure dotenv loads **before** using env variables.

---

## 10. Best Practices

* Keep DB logic in separate module
* Never commit `.env`
* Use async/await everywhere
* Wrap DB operations in try–catch
* Exit process on connection failure

---

## 11. Professional Connection Flow

```
Start App
→ Load dotenv
→ Connect to MongoDB
→ If success → Start server
→ If fail → Exit process
```

---

## Goal

Build a:

* Secure connection
* Scalable structure
* Production-ready database setup
